<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Pro Ultra</title>
    <style>
        :root { --bg: #f4f7f6; --text: #2c3e50; --panel: #ffffff; --primary: #0084ff; }
        .dark-mode { --bg: #1a1a1b; --text: #e4e6eb; --panel: #242526; --primary: #3d5afe; }
        
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 100px; transition: 0.3s; }
        .row { background: var(--panel); margin: 10px; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 10px; font-size: 16px; background: var(--panel); color: var(--text); box-sizing: border-box; }
        
        .controls { position: fixed; bottom: 0; width: 100%; background: var(--panel); display: flex; flex-wrap: wrap; justify-content: space-around; padding: 10px 0; border-top: 2px solid var(--primary); }
        .btn { padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; }
        
        #config-panel { padding: 15px; background: var(--panel); border-bottom: 1px solid #ddd; display: none; }
    </style>
</head>
<body id="appBody">

<div id="config-panel">
    <h4>Configuraci√≥n</h4>
    Idioma Voz: <select id="langSelect">
        <option value="es-ES">Espa√±ol (Espa√±a)</option>
        <option value="es-AR">Espa√±ol (Argentina)</option>
        <option value="es-MX">Espa√±ol (M√©xico)</option>
        <option value="en-US">Ingl√©s (USA)</option>
    </select>
    <br><br>
    Color Fondo: <input type="color" onchange="document.body.style.backgroundColor = this.value">
    <button onclick="toggleDarkMode()" class="btn">üåì Modo Noche</button>
</div>

<div id="main-container">
    <div class="row">
        <input type="time" class="time-input" value="12:00" style="border:none; font-weight:bold; color:var(--primary); background:transparent;">
        <textarea rows="3" oninput="processInput(this)" onfocus="lastActive = this" placeholder="Escriba o use micr√≥fono..."></textarea>
    </div>
</div>

<div class="controls">
    <button onclick="toggleConfig()" class="btn" style="background:#6c757d; color:white">‚öôÔ∏è</button>
    <button onclick="startVoice()" id="micBtn" class="btn" style="background:#28a745; color:white">üé§ Iniciar</button>
    <button onclick="superCorrect()" class="btn" style="background:#ffc107">‚ú® Corregir</button>
    <button onclick="addNewRow()" class="btn" style="background:#0084ff; color:white">‚ûï Fila</button>
    <button onclick="copyAll()" class="btn" style="background:#000; color:white">üìã Copiar</button>
</div>

<script>
    let lastActive = document.querySelector('textarea');

    // 1. CORRECTOR MEJORADO (Acentos, Puntos, May√∫sculas)
    function superCorrect() {
        document.querySelectorAll('textarea').forEach(area => {
            let t = area.value.trim();
            if(!t) return;
            
            // Diccionario de correcciones comunes
            const replacements = [
                { r: /\bpaso\b/gi, s: "pas√≥" }, { r: /\bpolicia\b/gi, s: "polic√≠a" },
                { r: /\bmovil\b/gi, s: "m√≥vil" }, { r: /\bdia\b/gi, s: "d√≠a" },
                { r: /\bvehiculo\b/gi, s: "veh√≠culo" }, { r: /\besta\b/gi, s: "est√°" }
            ];
            replacements.forEach(rule => t = t.replace(rule.r, rule.s));

            // Coherencia: May√∫scula inicial, quitar espacios dobles, punto final
            t = t.replace(/\s+/g, ' '); 
            t = t.charAt(0).toUpperCase() + t.slice(1);
            if (!/[.!?]$/.test(t)) t += ".";
            
            area.value = t;
        });
        alert("Correcci√≥n aplicada");
    }

    // 2. MICR√ìFONO (Soluci√≥n para Android)
    function startVoice() {
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!Speech) return alert("Tu navegador no soporta voz");

        const rec = new Speech();
        rec.lang = document.getElementById('langSelect').value;
        rec.continuous = false;

        document.getElementById('micBtn').style.background = "red";
        document.getElementById('micBtn').innerText = "üî¥ Grabando...";

        rec.onresult = (e) => {
            const transcript = e.results[0][0].transcript;
            if(lastActive) {
                lastActive.value += (lastActive.value ? " " : "") + transcript;
                processInput(lastActive);
            }
        };

        rec.onend = () => {
            document.getElementById('micBtn').style.background = "#28a745";
            document.getElementById('micBtn').innerText = "üé§ Iniciar";
        };

        rec.onerror = (e) => alert("Error de mic: " + e.error);
        rec.start();
    }

    // 3. COPIADO REAL (M√©todo Forzado)
    function copyAll() {
        let text = "";
        document.querySelectorAll('.row').forEach(r => {
            const time = r.querySelector('.time-input').value;
            const val = r.querySelector('textarea').value;
            if(val) text += `${time}. ${val}\n\n\n`;
        });

        const temp = document.createElement("textarea");
        temp.value = text.trim();
        document.body.appendChild(temp);
        temp.select();
        document.execCommand("copy");
        document.body.removeChild(temp);
        alert("¬°Copiado al portapapeles!");
    }

    // EXTRAS: UI y Filas
    function toggleConfig() {
        const p = document.getElementById('config-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
    }

    function addNewRow() {
        const container = document.getElementById('main-container');
        const now = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        const div = document.createElement('div');
        div.className = 'row';
        div.innerHTML = `<input type="time" class="time-input" value="${now}" style="border:none; font-weight:bold; color:var(--primary); background:transparent;"><textarea rows="3" oninput="processInput(this)" onfocus="lastActive = this"></textarea>`;
        container.appendChild(div);
        div.querySelector('textarea').focus();
    }

    function processInput(el) {
        lastActive = el;
        const match = el.value.match(/\b([01]?\d|2[0-3]):([0-5]\d)\b/);
        if (match) {
            el.closest('.row').querySelector('.time-input').value = match[0];
            el.value = el.value.replace(match[0], '').trim();
        }
    }
</script>
</body>
</html>